# Постобработка данных

## Описание

После завершения выгрузки данных из Teleopti автоматически выполняется постобработка Excel файла для устранения дубликатов и корректировки данных.

## Что делает постобработка

### 1. Поиск и устранение дубликатов в колонке "Потерянные"

- Находит строки с одинаковыми значениями в колонке "Потерянные"
- Группирует их по регионам
- Для каждого региона оставляет только одну строку с наибольшим количеством заметок
- Остальные строки в группе зануляет (устанавливает значение "Потерянные" = 0)

### 2. Обработка строк с отрицательным "Превышение"

- Находит все строки где значение "Превышение" < 0
- Зануляет колонку "Потерянные" для этих строк

## Логика работы

1. **Поиск дубликатов**: Группировка по значениям "Потерянные"
2. **Сравнение регионов**: Внутри каждой группы дубликатов группировка по "Регион"
3. **Сравнение заметок**: Для строк с одинаковым регионом и "Потерянные" выбирается строка с наибольшим количеством заметок
4. **Зануление**: Все остальные строки в группе зануляются
5. **Обработка отрицательных превышений**: Зануление "Потерянные" для строк с отрицательным "Превышение"

## Логирование

Процесс постобработки подробно логируется:
- Количество найденных дубликатов
- Детали по каждой группе дубликатов
- Информация о зануленных строках
- Статистика обработки

## Использование

Постобработка запускается автоматически после завершения основной выгрузки данных в обоих режимах:
- Новый режим (`--auto-date-processing`)
- Стандартный режим

## Модуль

Функционал реализован в модуле `modules/post_processor.py`:
- `post_process_excel_file(file_path)` - основная функция постобработки
- Автоматическое определение колонок
- Безопасная обработка с сохранением изменений

## Тестирование

Для тестирования постобработки используйте:
```bash
python test_postprocessor.py
```

## Важные замечания

- Постобработка выполняется только если есть результаты выгрузки
- Ошибки постобработки не прерывают основное выполнение
- Все изменения сохраняются в исходный Excel файл
- Файл должен быть закрыт в Excel перед запуском
